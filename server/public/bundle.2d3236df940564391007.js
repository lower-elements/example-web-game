/*! For license information please see bundle.2d3236df940564391007.js.LICENSE.txt */
(()=>{"use strict";class t{startTime;endTime;constructor(){this.startTime=null,this.endTime=null,this.start()}start(){this.startTime=Date.now(),this.endTime=null}stop(){null!==this.startTime&&null===this.endTime&&(this.endTime=Date.now())}restart(){this.startTime=Date.now(),this.endTime=null}get elapsed(){return null!==this.startTime?(null!==this.endTime?this.endTime:Date.now())-this.startTime:null}}class e{events;constructor(){this.events={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}emit(t,e){this.events[t]&&this.events[t].forEach((t=>{t(e)}))}cancel(t,e){const s=this.events[t];if(s){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}removeListener(t,e){this.cancel(t,e)}removeAllListeners(t){delete this.events[t]}once(t,e){this.on(t,(s=>{e(s),this.cancel(t,e)}))}}class s{mediaElement;source;isConnectedToSomething=!1;constructor(t,e,s=!1,i=!0){this.mediaElement=new Audio(`sounds/${e}`),this.mediaElement.loop=s,this.source=new MediaElementAudioSourceNode(t,{mediaElement:this.mediaElement}),i?this.source.connect(t.destination):this.isConnectedToSomething=!1}play(){this.mediaElement.currentTime=0,this.mediaElement.play()}pause(){this.mediaElement.pause()}resume(){this.mediaElement.play()}stop(){this.mediaElement.pause(),this.mediaElement.currentTime=0}connect(t,e=void 0,s=void 0){this.isConnectedToSomething&&(this.disconnect(this.source.context.destination),this.isConnectedToSomething=!1),this.source.connect(t,e,s)}disconnect(t){this.source.disconnect(t)}}class i{audioContext;gainNode;pannerNode;isRewired=!1;animatePanning;panningAnimationDuration=.02;constructor(t,e=0,s=0,i=0,n=!0,o=!0){this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.pannerNode=this.audioContext.createPanner(),this.pannerNode.panningModel=n?"HRTF":"equalpower",this.pannerNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),this.pannerNode.positionX.value=e,this.pannerNode.positionY.value=s,this.pannerNode.positionZ.value=i,this.animatePanning=o}rewireOutput(t){this.gainNode.disconnect(),null===t&&this.isRewired?(this.gainNode.connect(this.audioContext.destination),this.isRewired=!1):t&&(this.gainNode.connect(t),this.isRewired=!0)}get x(){return this.pannerNode.positionX.value}get y(){return this.pannerNode.positionY.value}get z(){return this.pannerNode.positionZ.value}set x(t){this.animatePanning?this.pannerNode.positionX.linearRampToValueAtTime(t,this.audioContext.currentTime+this.panningAnimationDuration):this.pannerNode.positionX.value=t}set y(t){this.animatePanning?this.pannerNode.positionY.linearRampToValueAtTime(t,this.audioContext.currentTime+this.panningAnimationDuration):this.pannerNode.positionY.value=t}set z(t){this.animatePanning?this.pannerNode.positionZ.linearRampToValueAtTime(t,this.audioContext.currentTime+this.panningAnimationDuration):this.pannerNode.positionZ.value=t}attachSound(t){t.connect(this.pannerNode)}playSound(t,e=!1){let i=new s(this.audioContext,t,e,!1);return this.attachSound(i),i.play(),i}}class n extends e{game;_x=0;_y=0;_z=0;map;movementTimer=new t;normalMovementTime=277;soundEmitter;id;constructor(t,e,s=0,n=0,o=0,r,a=!0){super(),this.game=t,this.id=e,this._x=s,this._y=n,this._z=o,this.map=r,this.soundEmitter=new i(t.audioContext,s,n,o,!0,a),this.map.addEntity(this)}rewireOutput(t){return this.soundEmitter.rewireOutput(t)}attachSound(t){return this.soundEmitter.attachSound(t)}playSound(t,e=!1){return this.soundEmitter.playSound(t,e)}get x(){return this._x}get y(){return this._y}get z(){return this._z}set x(t){this._x=t,this.soundEmitter.x=t}set y(t){this._y=t,this.soundEmitter.y=t}set z(t){this._z=t,this.soundEmitter.z=t}move(t,e,s,i=!0){if(!this.map.inBound(t,e,s))return;if(!this.map.entities.move(this,this))return;this.movementTimer.restart(),this.x=t,this.y=e,this.z=s;let n=this.map.getPlatformAt(t,e,s),o=n?n.type:"air";i&&"air"!=o&&this.playSound(`steps/${o}/${function(t,e){const s=Math.ceil(1),i=Math.floor(5);if(s>i)throw new Error("Min value must be less than or equal to max value");return Math.floor(Math.random()*(i-s+1))+s}()}.ogg`),this.fireEvent("move")}get canMove(){return(this.movementTimer.elapsed??0)>=this.normalMovementTime}fireEvent(t){this.emit(t,this)}destroy(){this.map.removeEntity(this)}}class o extends n{_facing=0;constructor(t,e=0,s=0,i=0,n){super(t,"player",e,s,i,n,!1)}updateListenerPosition(){this.game.setListenerPosition(this.x,this.y,this.z)}get facing(){return this.facing}setFacing(t){this._facing=t,this.game.setListenerOrientation(t)}get x(){return this._x}get y(){return this._y}get z(){return this._z}set x(t){super.x=t,this.updateListenerPosition()}set y(t){super.y=t,this.updateListenerPosition()}set z(t){super.z=t,this.updateListenerPosition()}}var r,a,h;!function(t){t.toArray=function(t){if(t instanceof Array)return t;const e=[];if(t[Symbol.iterator]){for(const s of t)e.push(s);return e}let s=t.next();for(;!s.done;)e.push(s.value),s=t.next();return e},t.toIterable=function*(...t){for(const e of t){if(!e)continue;const t=e();if(t instanceof Array)for(const e of t)yield e;else{let e=t.next();for(;!e.done;)yield e.value,e=t.next()}}},t.toIterableWithFilter=function*(t,...e){for(const s of e){if(!s)continue;const e=s();if(e instanceof Array)for(const s of e)t&&!t(s)||(yield s);else{let s=e.next();for(;!s.done;)t&&!t(s.value)||(yield s.value),s=e.next()}}},t.toIterableWithMap=function*(t,...e){for(const s of e){if(!s)continue;const e=s();if(e instanceof Array)for(const s of e)yield t(s);else{let s=e.next();for(;!s.done;)yield t(s.value),s=e.next()}}}}(r||(r={})),function(t){t.overlapsVec=function(t,e){return t.center.x-t.size.x<=e.x&&e.x<=t.center.x+t.size.x&&t.center.y-t.size.y<=e.y&&e.y<=t.center.y+t.size.y},t.overlapsAABB=function(t,e){return!(e.center.x-e.size.x>t.center.x+t.size.x||e.center.x+e.size.x<t.center.x-t.size.x||e.center.y-e.size.y>t.center.y+t.size.y||e.center.y+e.size.y<t.center.y-t.size.y)}}(a||(a={})),function(t){t.overlapsVec=function(e,s){switch(e.type){case"rectangle":return a.overlapsVec(e,s);case"square":return a.overlapsVec({center:e.center,size:{x:e.size,y:e.size}},s);case"circle":return t.overlapsVec({type:"ellipse",center:e.center,size:{x:e.size,y:e.size}},s);case"ellipse":return Math.pow(s.x-e.center.x,2)/Math.pow(e.size.x,2)+Math.pow(s.y-e.center.y,2)/Math.pow(e.size.y,2)<=1;default:throw new Error("not implemented")}},t.possiblelyOverlapsAABB=function(t,e){switch(t.type){case"ellipse":case"rectangle":return a.overlapsAABB(t,e);case"circle":case"square":return a.overlapsAABB({center:t.center,size:{x:t.size,y:t.size}},e);default:throw new Error("not implemented")}},t.createRectangle=function(t,e){return"number"==typeof e?{type:"square",center:t,size:e}:{type:"rectangle",center:t,size:e}},t.createEllipse=function(t,e){return"number"==typeof e?{type:"circle",center:t,size:e}:{type:"ellipse",center:t,size:e}}}(h||(h={}));class u{constructor(t,e,s=0){this.bounds=t,this.depth=s,this.divided=!1,this.units={},this.size=0,this.options=e||{unitKeyGetter:u.UniqueUnitAtPositionKeyFunc}}_add(t,e){if(!a.overlapsVec(this.bounds,t))return!1;if(this.depth==u.MaxDepth||!this.divided&&this.size<u.MaxElements){const s=this.options.unitKeyGetter(t,e,this);let i="existing";return this.units[s]||(this.size++,i="added"),this.units[s]={vec:t,unit:e},i}this.divided||this.divide();const s=this.northWest._add(t,e)||this.northEast._add(t,e)||this.southWest._add(t,e)||this.southEast._add(t,e);return"added"===s&&this.size++,s}add(t,e){return!!this._add(t,e)}_move(t,e,s){if(!a.overlapsVec(this.bounds,t))return!1;if(!this.divided){const i=this.options.unitKeyGetter(t,s,this);if(!this.units[i])return!1;if(e&&a.overlapsVec(this.bounds,e)){const t=this.options.unitKeyGetter(e,s,this);return t!==i?(delete this.units[i],this.units[t]={vec:e,unit:s}):this.units[i]={vec:e,unit:s},"moved"}return delete this.units[i],this.size--,"removed"}const i=this.northWest._move(t,e,s)||this.northEast._move(t,e,s)||this.southWest._move(t,e,s)||this.southEast._move(t,e,s);return"removed"===i&&(this.size--,e)?this.add(e,s)?"moved":"removed":i}move(t,e,s){if(!a.overlapsVec(this.bounds,e))return!1;if("removed"===this._move(t,e,s))throw new Error("unexpected");return!0}delete(t,e){return"removed"===this._move(t,void 0,e)}clear(){this.units={},this.size=0,this.divided=!1,this.northWest=this.northEast=this.southWest=this.southEast=void 0}has(t,e){if(!a.overlapsVec(this.bounds,t))return!1;if(!this.divided){const s=this.options.unitKeyGetter(t,e,this);return!!this.units[s]}return this.northWest.has(t,e)||this.northEast.has(t,e)||this.southWest.has(t,e)||this.southEast.has(t,e)}divide(){this.divided=!0;const t=this.bounds.size.x/2,e=this.bounds.size.y/2;this.northWest=new u({center:{x:this.bounds.center.x-t,y:this.bounds.center.y-e},size:{x:t,y:e}},this.options,this.depth+1),this.northEast=new u({center:{x:this.bounds.center.x+t,y:this.bounds.center.y-e},size:{x:t,y:e}},this.options,this.depth+1),this.southWest=new u({center:{x:this.bounds.center.x-t,y:this.bounds.center.y+e},size:{x:t,y:e}},this.options,this.depth+1),this.southEast=new u({center:{x:this.bounds.center.x+t,y:this.bounds.center.y+e},size:{x:t,y:e}},this.options,this.depth+1);for(const{vec:t,unit:e}of Object.values(this.units))this.northWest.add(t,e)||this.northEast.add(t,e)||this.southWest.add(t,e)||this.southEast.add(t,e);this.units={}}queryIteratable(t,e){const s="function"==typeof t?t:void 0;if(e&&!h.possiblelyOverlapsAABB(e,this.bounds))return[];if(!this.divided){let t=Object.values(this.units);return e&&(t=t.filter((t=>h.overlapsVec(e,t.vec)))),s?t.map(s):t}return s?r.toIterableWithMap(s,(()=>this.northWest.queryIteratable(e)),(()=>this.northEast.queryIteratable(e)),(()=>this.southWest.queryIteratable(e)),(()=>this.southEast.queryIteratable(e))):r.toIterable((()=>this.northWest.queryIteratable(e)),(()=>this.northEast.queryIteratable(e)),(()=>this.southWest.queryIteratable(e)),(()=>this.southEast.queryIteratable(e)))}_queryReduce(t,e,s){if(t&&!h.possiblelyOverlapsAABB(t,this.bounds))return s;if(!this.divided){let i=Object.values(this.units);return t&&(i=i.filter((e=>h.overlapsVec(t,e.vec)))),i.reduce(e,s)}let i=s;return i=this.northWest._queryReduce(t,e,i),i=this.northEast._queryReduce(t,e,i),i=this.southWest._queryReduce(t,e,i),i=this.southEast._queryReduce(t,e,i),i}queryReduce(t,e,s){return"function"==typeof t?this._queryReduce(void 0,t,e):this._queryReduce(t,e,s)}queryArray(t){return this._queryReduce(t,((t,e)=>(t.push(e),t)),[])}queryForEach(t,e){if("function"==typeof t)this._queryReduce(void 0,((e,s,i)=>t(s,i)));else{if(!e)return;this._queryReduce(t,((t,s,i)=>e(s,i)))}}queryMap(t,e){return"function"==typeof t?e?this._queryReduce(void 0,((e,s,i)=>(e.push(t(s,i)),e)),[]):[]:e?this._queryReduce(t,((t,s,i)=>(t.push(e(s,i)),t)),[]):[]}_dumpToString(t){const e="            ".substring(0,this.depth);if(!this.divided)return t.push(e),t.push(JSON.stringify(this.units)),t.push("\n"),t;for(const s of[{str:"NW",qt:this.northWest},{str:"NE",qt:this.northEast},{str:"SW",qt:this.southWest},{str:"SE",qt:this.southEast}])t.push(e),t.push(s.str),t.push(` (${s.qt.size}):\n`),s.qt._dumpToString(t);return t}toString(){return this._dumpToString([]).join("")}}u.MaxElements=8,u.MaxDepth=8,u.UniqueUnitAtPositionKeyFunc=(t,e,s)=>s.options.integerCoordinate?t.x+2*s.bounds.size.x*t.y:`${t.x},${t.y}`;class d extends Error{constructor(t){super(t)}}class c{constructor(t,e){this.quardTree=new u(t,e),this.unitPositionGetter=e.unitPositionGetter}get size(){return this.quardTree.size}get bounds(){return this.quardTree.bounds}add(t){const e=this.unitPositionGetter(t);if(!this.quardTree.add(e,t))throw new d(`position ${JSON.stringify(e)} is out of bounds: ${JSON.stringify(this.quardTree.bounds)}`);return this}move(t,e){return this.quardTree.move(this.unitPositionGetter(t),e,t)}delete(t){return this.quardTree.delete(this.unitPositionGetter(t),t)}has(t){return this.quardTree.has(this.unitPositionGetter(t),t)}clear(){this.quardTree.clear()}forEach(t){return this.quardTree.queryReduce(((e,s)=>{t(s.unit,s.unit,this)}),void 0)}entries(){return this.quardTree.queryIteratable((t=>[t.unit,t.unit]))}keys(){return this.values()}values(){return this.quardTree.queryIteratable((t=>t.unit))}get[Symbol.toStringTag](){return this.quardTree.toString()}[Symbol.iterator](){return this.values()}queryIteratable(t){return this.quardTree.queryIteratable(t)}queryReduce(t,e,s){return this.quardTree.queryReduce(t,e,s)}queryArray(t){return this.quardTree.queryArray(t)}queryForEach(t,e){this.quardTree.queryForEach(t,e)}queryMap(t,e){return this.quardTree.queryMap(t,e)}}c.UniqueUnitAtVecKeyFunc=u.UniqueUnitAtPositionKeyFunc;class l{minx;maxx;miny;maxy;minz;maxz;center;size;constructor(t,e,s,i,n,o){this.minx=t,this.maxx=e,this.miny=s,this.maxy=i,this.minz=n,this.maxz=o,this.center=this.calculateCenter(),this.size=this.calculateSize()}inBound(t,e,s){return t>=this.minx&&t<=this.maxx&&e>=this.miny&&e<=this.maxy&&s>=this.minz&&s<=this.maxz}closestPointTo(t){return{x:Math.max(this.minx,Math.min(t.x,this.maxx)),y:Math.max(this.miny,Math.min(t.y,this.maxy)),z:Math.max(this.minz,Math.min(t.z,this.maxz))}}intersects(t){return!(this.maxx<t.minx||this.minx>t.maxx||this.maxy<t.miny||this.miny>t.maxy||this.maxz<t.minz||this.minz>t.maxz)}calculateCenter(){return{x:(this.minx+this.maxx)/2,y:(this.miny+this.maxy)/2,z:(this.minz+this.maxz)/2}}calculateSize(){return{x:this.maxx-this.minx,y:this.maxy-this.miny,z:this.maxz-this.minz}}translate(t,e,s){this.minx+=t,this.maxx+=t,this.miny+=e,this.maxy+=e,this.minz+=s,this.maxz+=s}update(t){}destroy(){}}class p extends l{type;constructor(t,e,s,i,n,o,r="air"){super(t,e,s,i,n,o),this.type=r}}class m extends l{sound;gainNode;pannerNode;updateEventCallback;ref;audioContext;events=new e;ready=!1;constructor(t,e,i,n,o,r,a,h,u,d=.8){super(e,i,n,o,r,a),this.audioContext=t.audioContext,this.sound=new s(t.audioContext,h,!0,!1),this.sound.mediaElement.addEventListener("canplaythrough",(t=>{this.ready=!0,this.events.emit("ready",this)}),{once:!0}),this.gainNode=t.audioContext.createGain(),this.gainNode.gain.value=d,this.pannerNode=t.audioContext.createPanner(),this.pannerNode.panningModel="HRTF",this.sound.connect(this.pannerNode,void 0,void 0),this.ref=u,this.updateRef(u.x,u.y,u.z),this.pannerNode.connect(this.gainNode).connect(t.audioContext.destination),this.updateEventCallback=t=>this.updateRef(t.x,t.y,t.z),u.on("move",this.updateEventCallback)}updateRef(t,e,s){const i=this.closestPointTo({x:t,y:e,z:s}),{currentTime:n}=this.audioContext;this.pannerNode.positionX.value=i.x,this.pannerNode.positionY.value=i.y,this.pannerNode.positionZ.value=i.z}play(){this.sound.play()}pause(){this.sound.pause()}destroy(){this.ref.cancel("move",this.updateEventCallback),this.sound.stop()}}class y extends l{text;constructor(t,e,s,i,n,o,r="nowhere"){super(t,e,s,i,n,o),this.text=r}}class x extends l{platforms=[];zones=[];soundSources=[];entities;gameplay;get allElements(){return[...this.platforms,...this.zones,...this.soundSources]}constructor(t,e,s,i,n,o,r){super(e,s,i,n,o,r),this.gameplay=t,this.entities=new c({center:this.center,size:this.size},{unitKeyGetter:(t,e)=>e?e.id:0,unitPositionGetter:t=>t})}areAllSoundSourcesReady(){for(let t of this.soundSources)if(!t.ready)return!1;return!0}async load(){await this.loadFootsteps(),await this.loadSoundSources(),this.soundSources.forEach((t=>t.play()))}loadSoundSources(){return new Promise(((t,e)=>{if(!this.soundSources.length)return t();for(let e of this.soundSources)e.events.once("ready",(e=>{this.areAllSoundSourcesReady()&&t()}));this.areAllSoundSourcesReady()&&t()}))}loadFootsteps(){return new Promise(((t,e)=>{if(!this.platforms.length)return t();const s=[];for(let t of this.platforms)for(let e=1;e<=5;e++)s.push(new Audio(`sounds/steps/${t.type}/${e}.ogg`));function i(){for(let t of s)if(t.readyState<4)return!1;return!0}for(let e of s)e.addEventListener("canplaythrough",(e=>{i()&&t()}),{once:!0});i()&&t()}))}*getEntitiesIn(t){for(let{vec:e,unit:s}of this.entities.queryIteratable({center:t.center,size:t.size,type:"rectangle"}))s.z>=t.minz&&s.z<=t.maxz&&(yield s)}addEntity(t){return this.entities.add(t),t}removeEntity(t){return this.entities.delete(t)}spawnPlatform(t,e,s,i,n,o,r="air"){const a=new p(t,e,s,i,n,o,r);return this.platforms.push(a),a}spawnZone(t,e,s,i,n,o,r="nowhere"){const a=new y(t,e,s,i,n,o,r);return this.zones.push(a),a}spawnSoundSource(t,e,s,i,n,o,r,a=.9){const h=new m(this.gameplay.game,t,e,s,i,n,o,r,this.gameplay.player,a);return this.soundSources.push(h),h}getElementAt(t,e,s,i){for(let n of i.slice().reverse())if(n.inBound(t,e,s))return n;return null}getPlatformAt(t,e,s){return this.getElementAt(t,e,s,this.platforms)}getZoneAt(t,e,s){return this.getElementAt(t,e,s,this.zones)}getSoundSourceAt(t,e,s){return this.getElementAt(t,e,s,this.soundSources)}update(t){this.allElements.forEach((e=>e.update(t)))}destroy(){this.allElements.forEach((t=>t.destroy())),this.destroyAllEntities()}destroyAllEntities(){const t=[];this.entities.forEach((e=>t.push(e))),t.forEach((t=>t.destroy()))}}let f,v,g=0;function E(t,e=!0){let s=document.createElement("span");s.id=(++g).toString(),s.innerText=t;let i=e?v:f;i?.appendChild(s),i.children.length>=2&&i.firstChild&&i.removeChild(i.firstChild)}document.addEventListener("DOMContentLoaded",(function(){f=document.getElementById("speech_normal"),v=document.getElementById("speech_interupt")}));class z{game;map;player;blocked=!1;heldKeys={};onKeyPress={Escape:t=>{this.game.replaceWithMainMenu()},KeyC:t=>{E(`${this.player.x}, ${this.player.y}, ${this.player.z}`)}};onKeyRelease={};onKeyDown={KeyW:t=>{this.player.canMove&&this.player.move(this.player.x,this.player.y+1,this.player.z)},KeyD:t=>{this.player.canMove&&this.player.move(this.player.x+1,this.player.y,this.player.z)},KeyS:t=>{this.player.canMove&&this.player.move(this.player.x,this.player.y-1,this.player.z)},KeyA:t=>{this.player.canMove&&this.player.move(this.player.x-1,this.player.y,this.player.z)}};constructor(t){this.game=t,this.map=new x(this,0,70,0,70,0,10),this.player=new o(this.game,0,0,0,this.map),this.map.spawnPlatform(0,70,0,70,0,0,"grass"),this.map.spawnPlatform(30,60,30,60,0,0,"mud"),this.map.spawnPlatform(36,55,36,55,0,0,"water"),this.map.spawnSoundSource(0,70,0,70,0,70,"ambience/birds.ogg"),this.map.spawnSoundSource(36,55,36,55,0,70,"ambience/pond.ogg")}initialize(){}async onPush(){E("Welcome!"),this.player.updateListenerPosition(),this.blocked=!0,await this.map.load(),this.blocked=!1}onCover(){}onUncover(){this.player.updateListenerPosition()}onPop(){this.map.destroy()}update(t,e){if(!this.blocked){for(let t of e)if(t instanceof KeyboardEvent){let{code:e}=t;switch(t.type){case"keydown":this.heldKeys[e]=t,e in this.onKeyPress&&this.onKeyPress[e](t);break;case"keyup":delete this.heldKeys[e],e in this.onKeyRelease&&this.onKeyRelease[e](t)}}for(let t of Object.keys(this.heldKeys))t in this.onKeyDown&&this.onKeyDown[t](this.heldKeys[t])}}}class b{title;items=[];index=-1;game;moveSound;openSound;constructor(t,e){this.game=t,this.title=e,this.moveSound=new s(this.game.audioContext,"menu/move.ogg"),this.openSound=new s(this.game.audioContext,"menu/open.ogg")}setItems(t){this.items=t,this.resetIndex()}resetIndex(){0===this.items.length?this.index=-1:this.index=0}initialize(){}onPush(){E(this.title,!0),this.openSound.play()}onPop(){}onCover(){}onUncover(){}update(t,e){for(const t of e)if(this.items.length>0&&t instanceof KeyboardEvent&&"keydown"===t.type)switch(t.code){case"ArrowUp":this.setIndex(this.index-1);break;case"ArrowDown":this.setIndex(this.index+1);break;case"Enter":this.activateSelectedItem()}}activateSelectedItem(){this.items[this.index].callback(this.game,this)}setIndex(t){0!==this.items.length&&(this.index=(t%this.items.length+this.items.length)%this.items.length,this.speakCurrentItem(),this.moveSound.play())}speakCurrentItem(t=!0){this.index>=0&&E(this.items[this.index].label,t)}}class w{audioContext;gameContent;events=[];stack=[];fpsElement;lastFrameTime=0;frameCount=0;constructor(t){this.gameContent=t,this.audioContext=new AudioContext,this.subscribeToEvents(),this.setListenerOrientation(0),this.fpsElement=document.createElement("div"),this.fpsElement.style.position="absolute",this.fpsElement.style.top="10px",this.fpsElement.style.left="10px",this.gameContent.appendChild(this.fpsElement)}setListenerOrientation(t){const e=t/180*Math.PI;this.audioContext.listener.setOrientation(Math.sin(e),Math.cos(e),0,0,0,1)}setListenerPosition(t,e,s){this.audioContext.listener.positionX.value=t,this.audioContext.listener.positionY.value=e,this.audioContext.listener.positionZ.value=s}pushState(t){return this.stack.length>0&&this.stack[this.stack.length-1].onCover(),t.onPush(),this.stack.push(t),t}popState(){let t;return t=this.stack[this.stack.length-1],t.onPop(),this.stack.pop(),this.stack.length>0&&this.stack[this.stack.length-1].onUncover(),t}replaceState(t){this.stack.length>0&&this.popState(),this.pushState(t)}gameLoop(){this.stack.length>0&&this.stack[this.stack.length-1].update(16.6,this.events),this.events.length=0;const t=performance.now(),e=t-this.lastFrameTime;if(this.frameCount++,e>=1e3){const s=Math.round(1e3*this.frameCount/e);this.fpsElement.innerText=`${s} fps`,this.lastFrameTime=t,this.frameCount=0}requestAnimationFrame((()=>this.gameLoop()))}addEvent(t){this.events.push(t),t.stopPropagation()}subscribeToEvents(){const t=this.addEvent.bind(this);this.gameContent.addEventListener("keydown",t),this.gameContent.addEventListener("keyup",t)}replaceWithMainMenu(){const t=new b(this,"main menu");t.setItems([{label:"play",callback(t,e){t.replaceState(new z(t))}}]),this.replaceState(t)}}function q(){let t=document.getElementById("game");t.style.display="block",t.focus(),document.getElementById("test").style.display="none";const e=new w(t);e.replaceWithMainMenu(),e.gameLoop()}document.addEventListener("DOMContentLoaded",(function(){document.getElementById("test").onclick=q}))})();